<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×“×™×¨×•×’ ×ª××•× ×•×ª - Live</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); max-width: 600px; margin: auto; }
        h2 { margin-top: 0; color: #007bff; }
        img { max-width: 100%; border-radius: 10px; margin-bottom: 20px; max-height: 450px; object-fit: contain; border: 1px solid #ddd; background: #eee; min-height: 200px; }
        .rating-btns { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 10px; }
        button { padding: 15px 5px; border: none; border-radius: 8px; cursor: pointer; background: #007bff; color: white; font-weight: bold; font-size: 1.1rem; transition: transform 0.1s; }
        button:active { transform: scale(0.95); background: #0056b3; }
        .admin-panel { margin-top: 30px; border-top: 3px solid #007bff; padding-top: 20px; background: #e9ecef; border-radius: 10px; padding: 15px; }
        .hidden { display: none; }
        #stats { font-size: 1.4rem; font-weight: bold; color: #28a745; margin: 15px 0; }
        .voted-msg { font-size: 1.2rem; color: #666; font-weight: bold; padding: 20px; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="img-title">××ª×—×‘×¨ ×œ×©×¨×ª...</h2>
    <img id="main-image" src="" alt="×˜×•×¢×Ÿ ×ª××•× ×”...">
    
    <div id="user-view">
        <div id="rating-container">
            <p>×“×¨×’×• ××ª ×”×ª××•× ×” (1-10):</p>
            <div class="rating-btns" id="rating-area"></div>
        </div>
        <p id="voted-msg" class="voted-msg hidden">âœ… ×”×“×™×¨×•×’ × ×©×œ×—! ×”××ª×™× ×• ×œ×ª××•× ×” ×”×‘××”...</p>
    </div>

    <div id="admin-view" class="admin-panel hidden">
        <h3>ğŸ”§ ×œ×•×— ×‘×§×¨×” ×× ×”×œ</h3>
        <div style="margin-bottom: 15px;">
            <button onclick="prevImage()" style="background:#6c757d;">â¬…ï¸ ×”×§×•×“××ª</button>
            <span id="img-index" style="font-size: 1.5rem; margin: 0 15px; font-weight: bold;">1 / 100</span>
            <button onclick="nextImage()" style="background:#6c757d;">×”×‘××” â¡ï¸</button>
        </div>
        <div id="stats">×××•×¦×¢ × ×•×›×—×™: <span id="avg-score">0</span></div>
        <hr>
        <button style="background:#dc3545; width: 100%;" onclick="showSummary()">ğŸ† ×”×¦×’ ×ª××•× ×” ×× ×¦×—×ª</button>
    </div>
</div>

<script>
    // ×”×’×“×¨×•×ª ×”-Firebase ×”××¢×•×“×›× ×•×ª ×©×œ×š (×›×•×œ×œ ×”-URL ×”× ×›×•×Ÿ ×©×œ ××™×¨×•×¤×”):
    const firebaseConfig = {
        apiKey: "AIzaSyChEKlmRA-8gGG6hytsoAjlbf69EQq9UsY",
        authDomain: "my-rating-game.firebaseapp.com",
        projectId: "my-rating-game",
        storageBucket: "my-rating-game.firebasestorage.app",
        messagingSenderId: "911209380858",
        appId: "1:911209380858:web:ff65851ba5c95b82844243",
        databaseURL: "https://my-rating-game-default-rtdb.europe-west1.firebasedatabase.app"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const totalImages = 100;
    const isAdmin = window.location.search.includes('admin=true');
    const imgElement = document.getElementById('main-image');
    const indexElement = document.getElementById('img-index');
    const ratingArea = document.getElementById('rating-area');
    const ratingContainer = document.getElementById('rating-container');
    const votedMsg = document.getElementById('voted-msg');

    if (isAdmin) document.getElementById('admin-view').classList.remove('hidden');

    for (let i = 1; i <= 10; i++) {
        let btn = document.createElement('button');
        btn.innerText = i;
        btn.onclick = () => submitRating(i);
        ratingArea.appendChild(btn);
    }

    db.ref('currentImage').on('value', (snapshot) => {
        let idx = snapshot.val() || 1;
        
        // ×˜×¢×™× ×ª ×ª××•× ×” ×œ×¤×™ ×”×¤×•×¨××˜ ×©×œ×š
        const imagePath = `images/jpg-${idx}.JPG`;
        console.log("×× ×¡×” ×œ×˜×¢×•×Ÿ:", imagePath);
        imgElement.src = imagePath;
        
        indexElement.innerText = `${idx} / ${totalImages}`;
        document.getElementById('img-title').innerText = `×ª××•× ×” ${idx}`;
        
        ratingContainer.classList.remove('hidden');
        votedMsg.classList.add('hidden');
        
        if (isAdmin) updateStats(idx);
    });

    function submitRating(val) {
        db.ref('currentImage').once('value', (snap) => {
            let idx = snap.val() || 1;
            db.ref(`ratings/${idx}`).push(val);
            ratingContainer.classList.add('hidden');
            votedMsg.classList.remove('hidden');
        });
    }

    function nextImage() {
        db.ref('currentImage').transaction(idx => (idx < totalImages ? (idx || 1) + 1 : idx));
    }

    function prevImage() {
        db.ref('currentImage').transaction(idx => (idx > 1 ? idx - 1 : 1));
    }

    function updateStats(idx) {
        db.ref(`ratings/${idx}`).on('value', (snap) => {
            let data = snap.val();
            if (data) {
                let scores = Object.values(data);
                let avg = (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(2);
                document.getElementById('avg-score').innerText = avg + ` (${scores.length} ××“×¨×’×™×)`;
            } else {
                document.getElementById('avg-score').innerText = "××™×Ÿ ×“×™×¨×•×’×™× ×¢×“×™×™×Ÿ";
            }
        });
    }

    function showSummary() {
        db.ref('ratings').once('value', (snap) => {
            let all = snap.val();
            if (!all) return alert("××™×Ÿ × ×ª×•× ×™×.");
            let winner = {id: 0, avg: 0};
            for (let id in all) {
                let scores = Object.values(all[id]);
                let avg = scores.reduce((a, b) => a + b, 0) / scores.length;
                if (avg > winner.avg) winner = {id, avg};
            }
            alert(`×”×ª××•× ×” ×”×× ×¦×—×ª ×”×™× jpg-${winner.id}.JPG ×¢× ×××•×¦×¢ ${winner.avg.toFixed(2)}`);
        });
    }
</script>
</body>
</html>